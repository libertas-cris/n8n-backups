{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "IF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF": {
      "main": [
        [
          {
            "node": "Google Sheets1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "[400] Notifica - Cris",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets1": {
      "main": [
        [
          {
            "node": "[200] Notifica - Cris",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[400] Notifica - Cris": {
      "main": [
        [
          {
            "node": "Google Sheets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Alerta - Gestor de Tráfego",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[200] Notifica - Cris": {
      "main": [
        [
          {
            "node": "Notifica Convidado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Formata Telefone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formata Telefone": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notifica Convidado": {
      "main": [
        [
          {
            "node": "Notifica Lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2023-11-24T17:09:04.395Z",
  "id": "ZPkRm2xzboPY7IeU",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "[REUNIÃO SECRETA] Cadastro de Convidados",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ebbac40b-934e-437b-8a89-be4542c3866f",
        "options": {}
      },
      "id": "be049c84-bed0-47d9-8072-d104b83c24c4",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        240,
        240
      ],
      "webhookId": "ebbac40b-934e-437b-8a89-be4542c3866f"
    },
    {
      "parameters": {
        "jsCode": "return typeof $node[\"Webhook\"].json[\"body\"] == 'string' ? JSON.parse($node[\"Webhook\"].json[\"body\"]) : $node[\"Webhook\"].json[\"body\"]\n"
      },
      "id": "a35cefec-4e8f-4782-9016-d8c8d7c2c441",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        440,
        240
      ]
    },
    {
      "parameters": {
        "jsCode": "$input.all()[0].json['Qual o E-mail que você usou na hora da compra da Reunião Secreta?'] = $input.all()[0].json['Qual o E-mail que você usou na hora da compra da Reunião Secreta?'].toLowerCase();\n\nreturn $input.all();\n"
      },
      "id": "3ce2b87a-aeaf-487e-b8db-b3848127e1a8",
      "name": "Code1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        640,
        240
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc",
          "mode": "list",
          "cachedResultName": "[ILA] [CICLO 4] Planilha Geral",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1578652669,
          "mode": "list",
          "cachedResultName": "[AUTO] Inscritos [AS11]",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc/edit#gid=1578652669"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Email",
              "lookupValue": "={{ $json['Qual o E-mail que você usou na hora da compra da Reunião Secreta?'] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "986b2049-de70-48f6-87ec-b8a77e96297e",
      "name": "Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        1120,
        240
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "aqyCUOYp9QE28Sw2",
          "name": "Cris - Libertas"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.Nome }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "e333b862-6bd6-4217-9dc5-d401f05c5507",
      "name": "IF",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1480,
        240
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc",
          "mode": "list",
          "cachedResultName": "[ILA] [CICLO 4] Planilha Geral",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 643496705,
          "mode": "list",
          "cachedResultName": "Convidados [AS11]",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc/edit#gid=643496705"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email comprador": "={{ $json.Email }}",
            "Chave(busca) comprador": "={{ $json.Telefone.slice(-7) }}",
            "Nome comprador": "={{ $json.Nome }}",
            "Nome convidado": "={{ $('Code1').item.json['Qual é o nome do seu convidado?'] }}",
            "Número convidado": "={{ $('Formata Telefone').item.json[\"Qual o número de Whatsapp do seu convidado?\"] }}",
            "Função na Clínica": "={{ $('Code1').item.json['Qual é a função dele(a) na sua clínica?'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Email comprador",
              "displayName": "Email comprador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Chave(busca) comprador",
              "displayName": "Chave(busca) comprador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nome comprador",
              "displayName": "Nome comprador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nome convidado",
              "displayName": "Nome convidado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Número convidado",
              "displayName": "Número convidado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Função na Clínica",
              "displayName": "Função na Clínica",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ingresso",
              "displayName": "Ingresso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "cc0dedea-438b-4e84-a8d1-822ffed9909d",
      "name": "Google Sheets1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        1720,
        60
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "aqyCUOYp9QE28Sw2",
          "name": "Cris - Libertas"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3C1825917D649026AAA446A65441921E/token/92B58C5DAD3489D5AD780116/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Client-Token",
              "value": "Fc42ae886be5842c29595e379b6c74fbaS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "=5581993515055"
            },
            {
              "name": "message",
              "value": "=*Convidado cadastrado*\n\nNome:  {{ $('Code1').item.json['Qual é o nome do seu convidado?'] }}\nWhatsapp: {{ $('Code1').item.json['Qual o número de Whatsapp do seu convidado?'] }}\n\nLink: wa.me/{{ $('Code1').item.json['Qual o número de Whatsapp do seu convidado?'] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "508fb467-851c-45a5-bb05-402e668946d0",
      "name": "[200] Notifica - Cris",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1940,
        60
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3C1825917D649026AAA446A65441921E/token/92B58C5DAD3489D5AD780116/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Client-Token",
              "value": "Fc42ae886be5842c29595e379b6c74fbaS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "=5581993515055"
            },
            {
              "name": "message",
              "value": "=*Comprador não achado no cadastro de convidado*\n\nEmail informado:  {{ $('Code1').item.json['Qual o E-mail que você usou na hora da compra da Reunião Secreta?'] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "e6585ffd-9b2f-4aee-913b-8e6e7f63d56b",
      "name": "[400] Notifica - Cris",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1720,
        360
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc",
          "mode": "list",
          "cachedResultName": "[ILA] [CICLO 4] Planilha Geral",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 643496705,
          "mode": "list",
          "cachedResultName": "Convidados [AS11]",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1INPXHLk2_yG-TSmi2mxGrTyqQjSGyf9jyWlVZN8XTHc/edit#gid=643496705"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email comprador": "={{ $json.Email }}",
            "Chave(busca) comprador": "={{ $json.Telefone.slice(-7) }}",
            "Nome comprador": "={{ $json.Nome }}",
            "Nome convidado": "={{ $('Code1').item.json['Qual é o nome do seu convidado?'] }}",
            "Número convidado": "={{ $('Code1').item.json['Qual o número de Whatsapp do seu convidado?'] }}",
            "Função na Clínica": "={{ $('Code1').item.json['Qual é a função dele(a) na sua clínica?'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Email comprador",
              "displayName": "Email comprador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Chave(busca) comprador",
              "displayName": "Chave(busca) comprador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nome comprador",
              "displayName": "Nome comprador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nome convidado",
              "displayName": "Nome convidado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Número convidado",
              "displayName": "Número convidado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Função na Clínica",
              "displayName": "Função na Clínica",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ingresso",
              "displayName": "Ingresso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "6b354e21-b6e5-4e0b-9362-92bbf073193f",
      "name": "Google Sheets2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        1940,
        360
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "aqyCUOYp9QE28Sw2",
          "name": "Cris - Libertas"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "15d557f0-94d5-4ccf-bf02-1c51f1be0c5d",
              "leftValue": "={{ $json['Qual é a função dele(a) na sua clínica?'] }}",
              "rightValue": "=Gestor de Tráfego",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5cb59851-5f06-489a-952e-029fec6de32d",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        960,
        680
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3C1825917D649026AAA446A65441921E/token/92B58C5DAD3489D5AD780116/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Client-Token",
              "value": "Fc42ae886be5842c29595e379b6c74fbaS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "=5581993515055"
            },
            {
              "name": "message",
              "value": "=🚨🚨Gestor de Tráfego na área🚨🚨\n\nLead da reunião secreta cadastrou gestor de t ráfego na lista de convidados.\n\nE-mail do lead: {{ $json['Qual o E-mail que você usou na hora da compra da Reunião Secreta?'] }}\n\nNúmero do cadastrado: {{ $json['Qual o número de Whatsapp do seu convidado?'] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "6719dfee-eb83-485b-847a-df67f6dd20e9",
      "name": "Alerta - Gestor de Tráfego",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1220,
        660
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3C1825917D649026AAA446A65441921E/token/92B58C5DAD3489D5AD780116/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Client-Token",
              "value": "Fc42ae886be5842c29595e379b6c74fbaS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('Formata Telefone').item.json[\"Qual o número de Whatsapp do seu convidado?\"] }}"
            },
            {
              "name": "message",
              "value": "=Olá, {{ $('Formata Telefone').item.json[\"Qual é o nome do seu convidado?\"].split(\" \")[0] }}, tudo bem?\n\nPassando pra informar que você foi cadastrado com sucesso para a reunião secreta que será no dia 21/05.\n\nNo dia da reunião enviaremos os dados de acesso para você aqui mesmo no whatsapp."
            }
          ]
        },
        "options": {}
      },
      "id": "1e2be992-992f-4efc-83a6-e31b7bde7068",
      "name": "Notifica Convidado",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2160,
        60
      ]
    },
    {
      "parameters": {
        "jsCode": "function formataTelefone(number) {\n    number = number.toString().replace(/[^\\d]/g, \"\")\n    let ddi = '55'\n    let ddd = number.substring(0, 2)\n\n    if (number.length == 13) {\n        let ddi = number.substring(0, 2)\n        let ddd = number.substring(2, 4)\n        return ddi + ddd + (ddd <= 28 ? number.substring(4, 13) : number.substring(5, 13))\n\n    } else if (number.length == 11) {\n        return ddi + ddd + (ddd <= 28 ? number.substring(2, 11) : number.substring(3, 11))\n\n    } else if (number.length == 10) {\n        return ddi + ddd + (ddd <= 28 ? '9' : '') + number.substring(2, 11)\n\n    } else if (number.length == 12) {\n        return number.substring(0, 2) == '55' ? number : (number.substring(0, 1) == '0' ? formataTelefone(number.substring(1, 12)) : number)\n\n    } else {\n        return number\n    }\n}\n\n$input.all()[0].json[\"Qual o número de Whatsapp do seu convidado?\"] = formataTelefone($node['Code1'].json[\"Qual o número de Whatsapp do seu convidado?\"])\n\nreturn $input.all();"
      },
      "id": "91cac113-035a-4aa6-9ce8-dad38d966ad6",
      "name": "Formata Telefone",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        840,
        240
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3C1825917D649026AAA446A65441921E/token/92B58C5DAD3489D5AD780116/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Client-Token",
              "value": "Fc42ae886be5842c29595e379b6c74fbaS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('Google Sheets').item.json.Telefone }}"
            },
            {
              "name": "message",
              "value": "=*Cadastro Realizado*\n\n{{ $('Formata Telefone').item.json[\"Qual é o nome do seu convidado?\"] }} receberá os dados de acessoda reunião no dia 21/05."
            }
          ]
        },
        "options": {}
      },
      "id": "2cd04a20-b2db-433f-bb01-b66b271d2360",
      "name": "Notifica Lead",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2360,
        60
      ]
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "n8n.marcosfoks.com.br",
            "user-agent": "Mozilla/5.0 (compatible; Google-Apps-Script; beanserver; +https://script.google.com; id: UAEmdDd9Y1mOfx2xh39gsKH6bXTju8vcx2g)",
            "content-length": "903",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare",
            "cf-connecting-ip": "34.116.22.5",
            "cf-ipcountry": "US",
            "cf-ray": "8796cc757c5644d0-ATL",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "content-type": "application/json",
            "x-forwarded-for": "172.69.71.143",
            "x-forwarded-host": "n8n.marcosfoks.com.br",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "bc917484dc53",
            "x-real-ip": "172.69.71.143"
          },
          "params": {},
          "query": {},
          "body": {
            "created_at": "1713969104115",
            "Form Id": "1FQki4Zur_xIVJPF2UumLhyD7gOuDJIWLDs23IC8c9FY",
            "Form Name": "Cadastre o seu convidado para a Reunião Secreta",
            "Form Url": "https://docs.google.com/forms/d/e/1FAIpQLScOyYbHQ-fxTGeg-sWh9XWNqbhrHtgqWpbWFkN7_dDb1dtuPA/viewform",
            "Response Number": "205",
            "Response Date": "Apr 24, 2024 7:31 AM",
            "Response Url": "https://docs.google.com/forms/d/e/1FAIpQLScOyYbHQ-fxTGeg-sWh9XWNqbhrHtgqWpbWFkN7_dDb1dtuPA/viewform?edit2=2_ABaOnufEZyf_QNat6iUJo4N-NcN4oYcm3FO4iiCClwDckw0IO2IOGP8Ppw2CdYRfJi7uf7Y",
            "Response Id": "2_ABaOnufEZyf_QNat6iUJo4N-NcN4oYcm3FO4iiCClwDckw0IO2IOGP8Ppw2CdYRfJi7uf7Y",
            "Submitted At": "1713969088743",
            "Qual o E-mail que você usou na hora da compra da Reunião Secreta?": "matheus@gmail.com",
            "Qual é o nome do seu convidado?": "Cris",
            "Qual é a função dele(a) na sua clínica?": "CRC",
            "Qual o número de Whatsapp do seu convidado?": "8193515055"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "HNdKTazc8iQXKV7C"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2023-10-12T03:16:03.155Z",
      "updatedAt": "2023-10-12T03:16:03.155Z",
      "id": "RsdI5HyLiEx96UXQ",
      "name": "RS"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-05-04T01:44:02.000Z",
  "versionId": "82935e10-986a-44fa-899c-e58412f6ef15"
}