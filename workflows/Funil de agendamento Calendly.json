{
  "active": true,
  "connections": {
    "Calendly Trigger": {
      "main": [
        [
          {
            "node": "Data Inicio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "Onboarding",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data Inicio": {
      "main": [
        [
          {
            "node": "Hora Inicio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hora Inicio": {
      "main": [
        [
          {
            "node": "Lembrete 24hr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lembrete 24hr": {
      "main": [
        [
          {
            "node": "Lembrete 1h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lembrete 1h": {
      "main": [
        [
          {
            "node": "Formata Telefone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formata Telefone": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Formata Telefone1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formata Telefone1": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-05-06T18:31:35.448Z",
  "id": "lbY10pZqf3a1xVWP",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Funil de agendamento Calendly",
  "nodes": [
    {
      "parameters": {
        "events": [
          "invitee.created"
        ]
      },
      "id": "94efc2c0-3c3b-40ba-82db-b6a4e74a4a4d",
      "name": "Calendly Trigger",
      "type": "n8n-nodes-base.calendlyTrigger",
      "typeVersion": 1,
      "position": [
        260,
        300
      ],
      "webhookId": "53ee9ca4-e407-45b6-9214-2229dd0226e6",
      "credentials": {
        "calendlyApi": {
          "id": "wqWBMv9UOe6pr9ef",
          "name": "Sala Black"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "19Ly9sNr406H-P1agA2q-74UWHeut1Migf66hGXnrH2M",
          "mode": "list",
          "cachedResultName": "[ILA] Funil de agendamento no Calendly",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19Ly9sNr406H-P1agA2q-74UWHeut1Migf66hGXnrH2M/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Agendamentos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19Ly9sNr406H-P1agA2q-74UWHeut1Migf66hGXnrH2M/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Data": "={{ $('Data Inicio').item.json.formattedDate }}",
            "Hora inicio": "={{ $('Hora Inicio').item.json.formattedHour }}",
            "Nome": "={{ $('Calendly Trigger').item.json.payload.name }}",
            "Email": "={{ $('Calendly Trigger').item.json.payload.email }}",
            "Whatsapp": "={{ $json.whatsapp }}",
            "Link": "={{ $('Calendly Trigger').item.json.payload.scheduled_event.location.join_url }}",
            "Criado em": "={{ $('Calendly Trigger').item.json.created_at }}",
            "Lembrete 24h": "={{ $node[\"Lembrete 24hr\"].json[\"24depois\"] }}",
            "Lembrete 1h": "={{ $node[\"Lembrete 1h\"].json[\"1antes\"] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Data",
              "displayName": "Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Hora inicio",
              "displayName": "Hora inicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nome",
              "displayName": "Nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Whatsapp",
              "displayName": "Whatsapp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Criado em",
              "displayName": "Criado em",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Lembrete 24h",
              "displayName": "Lembrete 24h",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Check 24hr",
              "displayName": "Check 24hr",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Lembrete 1h",
              "displayName": "Lembrete 1h",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Check 1hr",
              "displayName": "Check 1hr",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "8a7556d5-3fbc-40fc-9c1d-433c5bdbe3d1",
      "name": "Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.3,
      "position": [
        1680,
        280
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "aqyCUOYp9QE28Sw2",
          "name": "Cris - Libertas"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3CC464C467F3C09DF85996AA42CF65C4/token/2C661F295A0505B121FC569F/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Client-Token",
              "value": "Fc42ae886be5842c29595e379b6c74fbaS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $json.Whatsapp }}"
            },
            {
              "name": "message",
              "value": "={{ $json[\"Nome\"].split(\" \")[0] }}, \n\nSua Mentoria Individual está agendada para dia {{ $json[\"Data\"] }} às {{ $json[\"Hora inicio\"] }}. \n\nSe algum imprevisto acontecer você poderá remarcar a sua mentoria individual com no mínimo 12 horas de antecedência. \n\nCaso não seja realizado com esse prazo a mentoria será considerada como realizada. \n\nTodas as mentorias tem uma duração de 1 hora, se houver algum tipo de atraso, será contabilizado no tempo da mentoria. \n\nContamos com a sua colaboração  pois temos uma demanda grande e nosso foco é sempre te atender com a qualidade que você merece."
            }
          ]
        },
        "options": {}
      },
      "id": "160a2a63-8c45-4476-a564-0cbdfa303c0b",
      "name": "Onboarding",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1900,
        280
      ]
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $('Calendly Trigger').item.json.payload.scheduled_event.start_time }}",
        "format": "custom",
        "customFormat": "dd/MM/yyyy",
        "options": {
          "timezone": true
        }
      },
      "id": "07dc2ee9-f103-4d6a-98b4-fec309ada374",
      "name": "Data Inicio",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        480,
        300
      ]
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $('Calendly Trigger').item.json.payload.scheduled_event.start_time }}",
        "format": "custom",
        "customFormat": "HH:mm",
        "outputFieldName": "formattedHour",
        "options": {
          "timezone": true
        }
      },
      "id": "459b0a4e-de8e-42d3-a053-fdb2efda07a9",
      "name": "Hora Inicio",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        700,
        300
      ]
    },
    {
      "parameters": {
        "operation": "subtractFromDate",
        "magnitude": "={{ $('Calendly Trigger').item.json.payload.scheduled_event.start_time }}",
        "duration": 1,
        "outputFieldName": "24depois",
        "options": {}
      },
      "id": "cfa322d7-a1c2-4d2c-ab23-b8f01fa2b42c",
      "name": "Lembrete 24hr",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        900,
        300
      ]
    },
    {
      "parameters": {
        "operation": "subtractFromDate",
        "magnitude": "={{ $('Calendly Trigger').item.json.payload.scheduled_event.start_time }}",
        "timeUnit": "hours",
        "duration": 1,
        "outputFieldName": "1antes",
        "options": {}
      },
      "id": "b2f07746-3192-4778-aca1-c57dc507fd45",
      "name": "Lembrete 1h",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        1100,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "function formataTelefone(number) {\n    number = number.toString().replace(/[^\\d]/g, \"\")\n    let ddi = '55'\n    let ddd = number.substring(0, 2)\n\n    if (number.length == 13) {\n        let ddi = number.substring(0, 2)\n        let ddd = number.substring(2, 4)\n        return ddi + ddd + (ddd <= 28 ? number.substring(4, 13) : number.substring(5, 13))\n\n    } else if (number.length == 11) {\n        return ddi + ddd + (ddd <= 28 ? number.substring(2, 11) : number.substring(3, 11))\n\n    } else if (number.length == 10) {\n        return ddi + ddd + (ddd <= 28 ? '9' : '') + number.substring(2, 11)\n\n    } else if (number.length == 12) {\n        return number.substring(0, 2) == '55' ? number : (number.substring(0, 1) == '0' ? formataTelefone(number.substring(1, 12)) : number)\n\n    } else {\n        return number\n    }\n}\n\n$input.all()[0].json['whatsapp'] = formataTelefone($node[\"Calendly Trigger\"].json[\"payload\"][\"questions_and_answers\"][\"0\"][\"answer\"])\n\nreturn $input.all();"
      },
      "id": "82ebc17c-2fc4-4d9c-9a3d-2ab86b1cc1c3",
      "name": "Formata Telefone",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        1340,
        300
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "function formataTelefone(number) {\n    number = number.toString().replace(/[^\\d]/g, \"\")\n    let ddi = '55'\n    let ddd = number.substring(0, 2)\n\n    if (number.length == 13) {\n        let ddi = number.substring(0, 2)\n        let ddd = number.substring(2, 4)\n        return ddi + ddd + (ddd <= 28 ? number.substring(4, 13) : number.substring(5, 13))\n\n    } else if (number.length == 11) {\n        return ddi + ddd + (ddd <= 28 ? number.substring(2, 11) : number.substring(3, 11))\n\n    } else if (number.length == 10) {\n        return ddi + ddd + (ddd <= 28 ? '9' : '') + number.substring(2, 11)\n\n    } else if (number.length == 12) {\n        return number.substring(0, 2) == '55' ? number : (number.substring(0, 1) == '0' ? formataTelefone(number.substring(1, 12)) : number)\n\n    } else {\n        return number\n    }\n}\n\n$input.all()[0].json['whatsapp'] = formataTelefone($node[\"Calendly Trigger\"].json[\"payload\"][\"questions_and_answers\"][\"0\"][\"answer\"])\n\nreturn $input.all();"
      },
      "id": "b14bd799-f510-4412-8bc9-2a45f27f0509",
      "name": "Formata Telefone1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        1460,
        540
      ],
      "onError": "continueErrorOutput"
    }
  ],
  "pinData": {
    "Calendly Trigger": [
      {
        "json": {
          "created_at": "2024-05-08T03:55:24.000000Z",
          "created_by": "https://api.calendly.com/users/6f4d88e9-a72b-404c-bc4f-19704ab0d01a",
          "event": "invitee.created",
          "payload": {
            "cancel_url": "https://calendly.com/cancellations/2ab4bcd9-5f9f-43c7-acd8-8e6f80bfee42",
            "created_at": "2024-05-08T03:55:23.430801Z",
            "email": "matheuscrsithyan.2@gmail.com",
            "event": "https://api.calendly.com/scheduled_events/98217439-322a-40ae-bfc1-3131ff2600ec",
            "first_name": null,
            "invitee_scheduled_by": "https://api.calendly.com/users/6f4d88e9-a72b-404c-bc4f-19704ab0d01a",
            "last_name": null,
            "name": "Matheus Cristhyan",
            "new_invitee": null,
            "no_show": null,
            "old_invitee": null,
            "payment": null,
            "questions_and_answers": [
              {
                "answer": "+55 81 99351-5055",
                "position": 0,
                "question": "Número Whatsapp"
              },
              {
                "answer": "TESTE",
                "position": 1,
                "question": "Quais tópicos/dúvidas você gostaria que fossem tratados na reunião?"
              }
            ],
            "reconfirmation": null,
            "reschedule_url": "https://calendly.com/reschedulings/2ab4bcd9-5f9f-43c7-acd8-8e6f80bfee42",
            "rescheduled": false,
            "routing_form_submission": null,
            "scheduled_event": {
              "created_at": "2024-05-08T03:55:23.407188Z",
              "end_time": "2024-05-10T12:00:00.000000Z",
              "event_guests": [],
              "event_memberships": [
                {
                  "user": "https://api.calendly.com/users/6f4d88e9-a72b-404c-bc4f-19704ab0d01a",
                  "user_email": "suporte.salablack@gmail.com",
                  "user_name": "Sala Black"
                }
              ],
              "event_type": "https://api.calendly.com/event_types/b016b63d-9ed3-41e7-b43d-bd2fea0e600b",
              "invitees_counter": {
                "total": 1,
                "active": 1,
                "limit": 1
              },
              "location": {
                "join_url": "https://calendly.com/events/98217439-322a-40ae-bfc1-3131ff2600ec/google_meet",
                "status": "processing",
                "type": "google_conference"
              },
              "meeting_notes_html": null,
              "meeting_notes_plain": null,
              "name": "Reunião Individual | Sala Black",
              "start_time": "2024-05-10T11:00:00.000000Z",
              "status": "active",
              "updated_at": "2024-05-08T03:55:23.407188Z",
              "uri": "https://api.calendly.com/scheduled_events/98217439-322a-40ae-bfc1-3131ff2600ec"
            },
            "scheduling_method": null,
            "status": "active",
            "text_reminder_number": null,
            "timezone": "America/Sao_Paulo",
            "tracking": {
              "utm_campaign": null,
              "utm_source": null,
              "utm_medium": null,
              "utm_content": null,
              "utm_term": null,
              "salesforce_uuid": null
            },
            "updated_at": "2024-05-08T03:55:23.430801Z",
            "uri": "https://api.calendly.com/scheduled_events/98217439-322a-40ae-bfc1-3131ff2600ec/invitees/2ab4bcd9-5f9f-43c7-acd8-8e6f80bfee42"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Fortaleza",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": {
    "node:Calendly Trigger": {
      "webhookURI": "https://api.calendly.com/webhook_subscriptions/8a0da4b0-f612-4264-b666-3ce76d87d845"
    }
  },
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2024-06-12T20:40:35.000Z",
  "versionId": "f203fdb5-5934-4377-84a5-a15afa899286"
}